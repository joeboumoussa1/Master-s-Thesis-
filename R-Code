---
title: "Master's Thesis"
author: "Joseph Boumoussa"
date: "2024-03-10"
output: html_document
---


```{r install-packages}

# Load necessary libraries
library(tidyverse)
library(broom)
library(readxl)
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(plm)
library(lubridate)
library(MASS)
library(reshape2)
library(stargazer)
```


```{r Loading Data}
# Read the dataset
data <- read.csv("C:/Users/Administrator/Desktop/FWD/Combined FWDS.csv")

# Check the structure of your data, especially for factors
str(data)
head(data)

```

```{r Convert Necessary Variables}
data$Covid.19.Dummy <- as.factor(data$Covid.19.Dummy)
data$MJ.Legalization.Dummy <- as.factor(data$MJ.Legalization.Dummy)


data$Year <- year(as.Date(data$Year.Code, format = "%m/%d/%Y"))


data$State <- as.factor(data$State)

```


```{r cleaning- data visualization}


for (var_name in names(data)) {
  # Check if the variable is numeric
  if (is.numeric(data[[var_name]])) {
    
    plot <- ggplot(data, aes_string(x = var_name)) +
      geom_density(fill = "blue", alpha = 0.5) +  
      labs(title = paste("Kernel Density Plot of", var_name), x = var_name, y = "Density") +
      theme_minimal()
    
    print(plot)
  }
}

```


```{r}
data$lnDOD <- log(data$Drug.Overdose.Deaths)
data$inDOD <- 1/ data$Drug.Overdose.Deaths 
data$sqDOD <- data$Drug.Overdose.Deaths^2
data$cbDOD <- data$Drug.Overdose.Deaths^3


if (any(data$Drug.Overdose.Deaths <= 0)) {
    shift_value <- abs(min(data$Drug.Overdose.Deaths[data$Drug.Overdose.Deaths <= 0])) + 1
    data$Drug.Overdose.Deaths <- data$Drug.Overdose.Deaths + shift_value
} 
# Finding the optimal lambda and applying the Box-Cox transformation
bc_trans <- boxcox(lm(Drug.Overdose.Deaths ~ 1, data = data), 
                   lambda = seq(-2, 2, by = 0.1))

# Extract the lambda that maximizes the log-likelihood
optimal_lambdaDOD <- bc_trans$x[which.max(bc_trans$y)]

# Applying the Box-Cox transformation using the optimal lambda
data$bcDOD <- (data$Drug.Overdose.Deaths^optimal_lambdaDOD - 1) / optimal_lambdaDOD

# Adjust transformation if lambda is zero
if (optimal_lambdaDOD == 0) {
    data$bcDOD <- log(data$Drug.Overdose.Deaths)
}
# Plottng the transformed variable
library(ggplot2)
ggplot(data, aes(x = bcDOD)) +
    geom_density( fill = "skyblue") +
    labs(title = "Kernel Density Plot of Cubic Drug Overdose Deaths",
       x = "Cubic Drug Overdose Deaths", 
       y = "Density") +
  theme_minimal()

# Plot for lnDOD
ggplot(data, aes(x = lnDOD)) + 
  geom_density(fill = "blue", alpha = 0.5) + 
  labs(title = "Kernel Density Plot of Log Transformed Drug Overdose Deaths",
       x = "Log of Drug Overdose Deaths", 
       y = "Density") +
  theme_minimal()
# Plot for inDOD
ggplot(data, aes(x = inDOD)) + 
  geom_density(fill = "purple", alpha = 0.5) + 
  labs(title = "Kernel Density Plot of inverse Transformed Drug Overdose Deaths",
       x = "inverse of Drug Overdose Deaths", 
       y = "Density") +
  theme_minimal()

# Plot for sqDOD
ggplot(data, aes(x = sqDOD)) + 
  geom_density(fill = "green", alpha = 0.5) + 
  labs(title = "Kernel Density Plot of Squared Drug Overdose Deaths",
       x = "Squared Drug Overdose Deaths", 
       y = "Density") +
  theme_minimal()

# Plot for cbDOD
ggplot(data, aes(x = cbDOD)) + 
  geom_density(fill = "red", alpha = 0.5) + 
  labs(title = "Kernel Density Plot of Cubic Drug Overdose Deaths",
       x = "Cubic Drug Overdose Deaths", 
       y = "Density") +
  theme_minimal()

# Shapiro-Wilk Test for log transformation
shapiro_test_log <- shapiro.test(data$lnDOD)
shapiro_test_log

# Shapiro-Wilk Test for Box-Cox transformation
shapiro_test_bc <- shapiro.test(data$bcDOD)
shapiro_test_bc

print(optimal_lambdaDOD)

```


```{r}
data$lnSAF <- log(data$Total.Substance.abuse.Funds)
data$inSAF <- 1/ data$Total.Substance.abuse.Funds 
data$sqSAF <- data$Total.Substance.abuse.Funds^2
data$cbSAF <- data$Total.Substance.abuse.Funds^3


if (any(data$Total.Substance.abuse.Funds <= 0)) {
    shift_value <- abs(min(data$Total.Substance.abuse.Funds[data$Total.Substance.abuse.Funds <= 0])) + 1
    data$Total.Substance.abuse.Funds <- data$Total.Substance.abuse.Funds + shift_value
} 
# Finding the optimal lambda and applying the Box-Cox transformation
bc_trans <- boxcox(lm(Total.Substance.abuse.Funds ~ 1, data = data), 
                   lambda = seq(-2, 2, by = 0.1))

# Extract the lambda that maximizes the log-likelihood
optimal_lambdaSAF <- bc_trans$x[which.max(bc_trans$y)]

# Applying the Box-Cox transformation using the optimal lambda
data$bcSAF <- (data$Total.Substance.abuse.Funds^optimal_lambdaSAF - 1) / optimal_lambdaSAF

# Adjust transformation if lambda is zero
if (optimal_lambdaSAF == 0) {
    data$bcSAF <- log(data$Total.Substance.abuse.Funds)
}
# Plot the transformed variable
library(ggplot2)
ggplot(data, aes(x = bcSAF)) +
    geom_density( fill = "skyblue") +
    labs(title = "B-C",
       x = "SAF", 
       y = "Density") +
  theme_minimal()


ggplot(data, aes(x = lnSAF)) + 
  geom_density(fill = "blue", alpha = 0.5) + 
  labs(title = "ln",
       x = "SAF", 
       y = "Density") +
  theme_minimal()

ggplot(data, aes(x = inSAF)) + 
  geom_density(fill = "purple", alpha = 0.5) + 
  labs(title = "in",
       x = "SAF", 
       y = "Density") +
  theme_minimal()


ggplot(data, aes(x = sqSAF)) + 
  geom_density(fill = "green", alpha = 0.5) + 
  labs(title = "Kernel Density Plot of Squared Drug Overdose Deaths",
       x = "Squared Drug Overdose Deaths", 
       y = "Density") +
  theme_minimal()

# Plot for cbDOD
ggplot(data, aes(x = cbSAF)) + 
  geom_density(fill = "red", alpha = 0.5) + 
  labs(title = "Kernel Density Plot of Cubic Drug Overdose Deaths",
       x = "Cubic Drug Overdose Deaths", 
       y = "Density") +
  theme_minimal()

shapiro_bc <- shapiro.test(data$bcSAF)
shapiro_ln <- shapiro.test(data$lnSAF)
shapiro_ln
shapiro_bc
print(optimal_lambdaSAF)
```


```{r}


data$Total.Mental.Health.funds[data$Total.Mental.Health.funds <= 0] <- NA

# Apply transformations
data$lnMAF <- log(data$Total.Mental.Health.funds)
data$inMAF <- 1 / data$Total.Mental.Health.funds
data$sqMAF <- data$Total.Mental.Health.funds^2
data$cbMAF <- data$Total.Mental.Health.funds^3

# Box-Cox Transformation


if (any(data$Total.Mental.Health.funds <= 0)) {
    shift_value <- abs(min(data$Total.Mental.Health.funds[data$Total.Mental.Health.funds <= 0])) + 1
    data$Total.Mental.Health.funds <- data$Total.Mental.Health.funds + shift_value
} 
# Finding the optimal lambda and applying the Box-Cox transformation
bc_trans <- boxcox(lm(Total.Mental.Health.funds ~ 1, data = data), 
                   lambda = seq(-2, 2, by = 0.1))

# Extract the lambda that maximizes the log-likelihood
optimal_lambdaMAF <- bc_trans$x[which.max(bc_trans$y)]

# Applying the Box-Cox transformation using the optimal lambda
data$bcMAF <- (data$Total.Mental.Health.funds^optimal_lambdaMAF - 1) / optimal_lambdaMAF

# Adjust transformation if lambda is zero
if (optimal_lambdaMAF == 0) {
    data$bcMAF <- log(data$Total.Mental.Health.funds)
}
# Function to plot density for each transformed variable
plot_density <- function(data, variable, title, fill_color) {
  ggplot(data, aes_string(x = variable)) +
    geom_density(fill = fill_color, alpha = 0.5) +
    labs(title = title, x = variable, y = "Density") +
    theme_minimal()
}

# Generate density plots
plot_density(data, "lnMAF", "Log Transformed SAF", "blue")
plot_density(data, "inMAF", "Inverse Transformed SAF", "purple")
plot_density(data, "sqMAF", "Squared SAF", "green")
plot_density(data, "cbMAF", "Cubic SAF", "red")
plot_density(data, "bcMAF", "Box-Cox Transformed SAF", "skyblue")

# Perform Shapiro-Wilk Test and print results
shapiro_ln <- shapiro.test(data$lnMAF)
shapiro_bc <- shapiro.test(data$bcMAF)

print(shapiro_ln)
print(shapiro_bc)

print(optimal_lambdaMAF)
```




```{r}

data$Unemployed.P.[data$Unemployed.P. <= 0] <- NA

# Apply transformations
data$lnUE <- log(data$Unemployed.P.)
data$inUE <- 1 / data$Unemployed.P.
data$sqUE <- data$Unemployed.P.^2
data$cbUE <- data$Unemployed.P.^3

# Box-Cox Transformation

# Adding a small constant if there are zero or negative values
if (any(data$Unemployed.P. <= 0)) {
    shift_value <- abs(min(data$Unemployed.P.[data$Unemployed.P. <= 0])) + 1
    data$Unemployed.P. <- data$Unemployed.P. + shift_value
} 
# Finding the optimal lambda and applying the Box-Cox transformation
bc_trans <- boxcox(lm(Unemployed.P. ~ 1, data = data), 
                   lambda = seq(-2, 2, by = 0.1))

# Extract the lambda that maximizes the log-likelihood
optimal_lambdaUE <- bc_trans$x[which.max(bc_trans$y)]

# Applying the Box-Cox transformation using the optimal lambda
data$bcUE <- (data$Unemployed.P.^optimal_lambdaUE - 1) / optimal_lambdaUE

# Adjust transformation if lambda is zero
if (optimal_lambdaUE == 0) {
    data$bcUE <- log(data$Unemployed.P.)
}
# Function to plot density for each transformed variable
plot_density <- function(data, variable, title, fill_color) {
  ggplot(data, aes_string(x = variable)) +
    geom_density(fill = fill_color, alpha = 0.5) +
    labs(title = title, x = variable, y = "Density") +
    theme_minimal()
}

# Generate density plots
plot_density(data, "lnUE", "Log Transformed", "blue")
plot_density(data, "inUE", "Inverse Transformed", "purple")
plot_density(data, "sqUE", "Squared", "green")
plot_density(data, "cbUE", "Cubic", "red")
plot_density(data, "bcUE", "Box-Cox Transformed", "skyblue")

# Perform Shapiro-Wilk Test and print results
shapiro_ln <- shapiro.test(data$lnUE)
shapiro_bc <- shapiro.test(data$bcUE)
shapiro_in <- shapiro.test(data$inUE)

print(shapiro_ln)
print(shapiro_bc)
print(shapiro_in)
print(optimal_lambdaUE)
```


```{r}

data$N.SSATS.Facilities[data$N.SSATS.Facilities <= 0] <- NA

# Apply transformations
data$lnNSF <- log(data$N.SSATS.Facilities)
data$inNSF <- 1 / data$N.SSATS.Facilities
data$sqNSF <- data$N.SSATS.Facilities^2
data$cbNSF <- data$N.SSATS.Facilities^3

# Box-Cox Transformation

# Adding a small constant if there are zero or negative values
if (any(data$N.SSATS.Facilities <= 0, na.rm = TRUE)) {
    shift_value <- abs(min(data$N.SSATS.Facilities[data$N.SSATS.Facilities <= 0], na.rm = TRUE)) + 1
    data$N.SSATS.Facilities <- ifelse(is.na(data$N.SSATS.Facilities), 
                                      NA, 
                                      data$N.SSATS.Facilities + shift_value)
} 
# Finding the optimal lambda and applying the Box-Cox transformation
bc_trans <- boxcox(lm(N.SSATS.Facilities ~ 1, data = data), 
                   lambda = seq(-2, 2, by = 0.1))

# Extract the lambda that maximizes the log-likelihood
optimal_lambdaNSF <- bc_trans$x[which.max(bc_trans$y)]

# Applying the Box-Cox transformation using the optimal lambda
data$bcNSF <- (data$N.SSATS.Facilities^optimal_lambdaNSF - 1) / optimal_lambdaNSF

# Adjust transformation if lambda is zero
if (optimal_lambdaNSF == 0) {
    data$bcNSF <- log(data$N.SSATS.Facilities)
}
# Function to plot density for each transformed variable
plot_density <- function(data, variable, title, fill_color) {
  ggplot(data, aes_string(x = variable)) +
    geom_density(fill = fill_color, alpha = 0.5) +
    labs(title = title, x = variable, y = "Density") +
    theme_minimal()
}

# Generate density plots
plot_density(data, "lnNSF", "Log Transformed", "blue")
plot_density(data, "inNSF", "Inverse Transformed", "purple")
plot_density(data, "sqNSF", "Squared", "green")
plot_density(data, "cbNSF", "Cubic", "red")
plot_density(data, "bcNSF", "Box-Cox Transformed", "skyblue")

# Perform Shapiro-Wilk Test and print results
shapiro_ln <- shapiro.test(data$lnNSF)
shapiro_bc <- shapiro.test(data$bcNSF)
shapiro_in <- shapiro.test(data$inNSF)

print(shapiro_ln)
print(shapiro_bc)
print(shapiro_in)
print(optimal_lambdaNSF)
```

```{r}

data$Homeless.Persons[data$Homeless.Persons <= 0] <- NA

# Apply transformations
data$lnHP <- log(data$Homeless.Persons)
data$inHP <- 1 / data$Homeless.Persons
data$sqHP <- data$Homeless.Persons^2
data$cbHP <- data$Homeless.Persons^3

# Box-Cox Transformation

# Adding a small constant if there are zero or negative values
if (any(data$Homeless.Persons <= 0)) {
    shift_value <- abs(min(data$Homeless.Persons[data$Homeless.Persons <= 0])) + 1
    data$Homeless.Persons <- data$Homeless.Persons + shift_value
} 
# Finding the optimal lambda and applying the Box-Cox transformation
bc_trans <- boxcox(lm(Homeless.Persons ~ 1, data = data), 
                   lambda = seq(-2, 2, by = 0.1))

# Extract the lambda that maximizes the log-likelihood
optimal_lambdaHP <- bc_trans$x[which.max(bc_trans$y)]

# Applying the Box-Cox transformation using the optimal lambda
data$bcHP <- (data$Homeless.Persons^optimal_lambdaHP - 1) / optimal_lambdaHP

# Adjust transformation if lambda is zero
if (optimal_lambdaHP == 0) {
    data$bcHP <- log(data$Homeless.Persons)
}
# Function to plot density for each transformed variable
plot_density <- function(data, variable, title, fill_color) {
  ggplot(data, aes_string(x = variable)) +
    geom_density(fill = fill_color, alpha = 0.5) +
    labs(title = title, x = variable, y = "Density") +
    theme_minimal()
}

# Generate density plots
plot_density(data, "lnHP", "Log Transformed", "blue")
plot_density(data, "inHP", "Inverse Transformed", "purple")
plot_density(data, "sqHP", "Squared", "green")
plot_density(data, "cbHP", "Cubic", "red")
plot_density(data, "bcHP", "Box-Cox Transformed", "skyblue")

# Perform Shapiro-Wilk Test and print results
shapiro_ln <- shapiro.test(data$lnHP)
shapiro_bc <- shapiro.test(data$bcHP)
shapiro_in <- shapiro.test(data$inHP)

print(shapiro_ln)
print(shapiro_bc)
print(shapiro_in)
print(optimal_lambdaHP)
```

```{r}

data$Naloxone.Dispensing.Rates[data$Naloxone.Dispensing.Rates <= 0] <- NA

# Apply transformations
data$lnNDR <- log(data$Naloxone.Dispensing.Rates)
data$inNDR <- 1 / data$Naloxone.Dispensing.Rates
data$sqNDR <- data$Naloxone.Dispensing.Rates^2
data$cbNDR <- data$Naloxone.Dispensing.Rates^3

# Box-Cox Transformation

# Adding a small constant if there are zero or negative values
if (any(data$Naloxone.Dispensing.Rates <= 0, na.rm = TRUE)) {
    shift_value <- abs(min(data$Naloxone.Dispensing.Rates[data$Naloxone.Dispensing.Rates <= 0], na.rm = TRUE)) + 1
    data$Naloxone.Dispensing.Rates <- ifelse(is.na(data$Naloxone.Dispensing.Rates), 
                                      NA, 
                                      data$Naloxone.Dispensing.Rates + shift_value)
} 
# Finding the optimal lambda and applying the Box-Cox transformation
bc_trans <- boxcox(lm(Naloxone.Dispensing.Rates ~ 1, data = data), 
                   lambda = seq(-2, 2, by = 0.1))

# Extract the lambda that maximizes the log-likelihood
optimal_lambdaNDR <- bc_trans$x[which.max(bc_trans$y)]

# Applying the Box-Cox transformation using the optimal lambda
data$bcNDR <- (data$Naloxone.Dispensing.Rates^optimal_lambdaNDR - 1) / optimal_lambdaNDR

# Adjust transformation if lambda is zero
if (optimal_lambdaNDR == 0) {
    data$bcNDR <- log(data$Naloxone.Dispensing.Rates)
}
# Function to plot density for each transformed variable
plot_density <- function(data, variable, title, fill_color) {
  ggplot(data, aes_string(x = variable)) +
    geom_density(fill = fill_color, alpha = 0.5) +
    labs(title = title, x = variable, y = "Density") +
    theme_minimal()
}

# Generate density plots
plot_density(data, "lnNDR", "Log Transformed", "blue")
plot_density(data, "inNDR", "Inverse Transformed", "purple")
plot_density(data, "sqNDR", "Squared", "green")
plot_density(data, "cbNDR", "Cubic", "red")
plot_density(data, "bcNDR", "Box-Cox Transformed", "skyblue")

# Perform Shapiro-Wilk Test and print results
shapiro_ln <- shapiro.test(data$lnNDR)
shapiro_bc <- shapiro.test(data$bcNDR)
shapiro_in <- shapiro.test(data$inNDR)

print(shapiro_ln)
print(shapiro_bc)
print(shapiro_in)
print(optimal_lambdaNDR)
```
```{r}

# Apply transformations
data$lnPOP <- log(data$Population)
data$inPOP <- 1 / data$Population
data$sqPOP <- data$Population^2
data$cbPOP <- data$Population^3

# Box-Cox Transformation

# Adding a small constant if there are zero or negative values
if (any(data$Population <= 0, na.rm = TRUE)) {
    shift_value <- abs(min(data$Population[data$Population <= 0], na.rm = TRUE)) + 1
    data$Population <- ifelse(is.na(data$Population), 
                                      NA, 
                                      data$Population + shift_value)
} 
# Finding the optimal lambda and applying the Box-Cox transformation
bc_trans <- boxcox(lm(Population ~ 1, data = data), 
                   lambda = seq(-2, 2, by = 0.1))

# Extract the lambda that maximizes the log-likelihood
optimal_lambdaPOP <- bc_trans$x[which.max(bc_trans$y)]

# Applying the Box-Cox transformation using the optimal lambda
data$bcPOP <- (data$Population^optimal_lambdaPOP - 1) / optimal_lambdaPOP

# Adjust transformation if lambda is zero
if (optimal_lambdaPOP == 0) {
    data$bcPOP <- log(data$Population)
}
# Function to plot density for each transformed variable
plot_density <- function(data, variable, title, fill_color) {
  ggplot(data, aes_string(x = variable)) +
    geom_density(fill = fill_color, alpha = 0.5) +
    labs(title = title, x = variable, y = "Density") +
    theme_minimal()
}

# Generate density plots
plot_density(data, "lnPOP", "Log Transformed", "blue")
plot_density(data, "inPOP", "Inverse Transformed", "purple")
plot_density(data, "sqPOP", "Squared", "green")
plot_density(data, "cbPOP", "Cubic", "red")
plot_density(data, "bcPOP", "Box-Cox Transformed", "skyblue")

# Perform Shapiro-Wilk Test and print results
shapiro_ln <- shapiro.test(data$lnPOP)
shapiro_bc <- shapiro.test(data$bcPOP)
shapiro_in <- shapiro.test(data$inPOP)

print(shapiro_ln)
print(shapiro_bc)
print(shapiro_in)
print(optimal_lambdaPOP)
```

```{r}
#Dropping excess variables 

data <- data %>%
  dplyr::select(-c( inDOD, sqDOD, cbDOD, inSAF, cbSAF, sqSAF, inMAF, sqMAF, cbMAF, 
                    bcUE, inUE, sqUE, cbUE, inNSF, sqNSF, cbNSF, 
                    inHP, sqHP, cbHP, inNDR, sqNDR, cbNDR))

```


```{r}
#Renaming Variable
data <- data %>%
  rename(PCI = Per.Capita.Personal.Income)

```

```{r Setting Up the Panel Data Frame}

#Converting data frame to pdata.frame for panel analysis
pdata <- pdata.frame(data, index = c("State", "Year.Code"))

summary(data)

```

```{r}

correct_columns <- c("Drug.Overdose.Deaths", "Total.Substance.abuse.Funds", 
                     "Total.Mental.Health.funds", 
                     "Unemployed.P.", "PCI", 
                     "N.SSATS.Facilities", "Homeless.Persons", 
                     "Naloxone.Dispensing.Rates")

# Calculate the correlation matrix
cor_matrix <- cor(data[, correct_columns], use = "complete.obs")
print(cor_matrix)

# Ensure the correlation matrix is available and melted
melted_corr_matrix <- reshape2::melt(cor_matrix)

# Create a heatmap with correlation values annotated
ggplot(melted_corr_matrix, aes(x = Var1, y = Var2, fill = value)) +
  geom_tile(color = "white") +  # Adds a white border around each tile
  geom_text(aes(label = sprintf("%.2f", value)), size = 3, vjust = 1) +  # Adds text to each tile
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", midpoint = 0,
                       limit = c(-1, 1), space = "Lab", name = "Pearson\nCorrelation") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 12),
        axis.text.y = element_text(size = 12)) +
  labs(title = "Correlation Matrix Heatmap", x = "", y = "")
```


```{r Pooled OLS Model}

Simple_model <- plm(lnDOD ~ lnSAF,
             data = pdata, model = "pooling")

Intermediate_model <- plm(lnDOD ~ lnSAF + lnMAF + lnUE + PCI + lnHP + lnPOP + Covid.19.Dummy,
             data = pdata, model = "pooling")


ln_OLS_model <- plm(lnDOD ~ lnSAF + lnMAF + lnUE + PCI + lnNSF + lnHP + lnNDR + lnPOP + Covid.19.Dummy + MJ.Legalization.Dummy,
             data = pdata, model = "pooling")

summary(Simple_model)
summary(Intermediate_model)
summary(ln_OLS_model)
```

```{r}

# Export model summary 
stargazer(Simple_model, type = "html", out = "Simple_model_summary.html")
stargazer(Intermediate_model, type = "html", out = "Intermediate_model_summary.html")
stargazer(ln_OLS_model, type = "html", out = "Full_model_summary.html")

# Using stargazer to compare models
stargazer(Simple_model, Intermediate_model, ln_OLS_model, type = "text",
          title = "Comparison of Regression Models",
          align = TRUE,
          style = "AER",
          column.labels = c("Simple Model", "Intermediate Model", "Full Model"),
          model.names = TRUE,
          dep.var.labels.include = TRUE,
          dep.var.caption = "Dependent variable: bcDOD",
          covariate.labels = c( "lnSAF", "lnMAF", "lnUE", "PCI", "lnHP", "Covid-19 Dummy", "MJ Legalization Dummy", "lnMAF", "lnNSF", "lnHP", "lnNDR"),
          omit.stat = c("LL", "ser", "f"))


stargazer(Simple_model, Intermediate_model, ln_OLS_model, type = "html",
          out = "model_comparison.html")


```

```{r}

# List of specific states
specific_states <- c("Arizona", "Louisiana", "New Hampshire", "Ohio", "Tennessee")
state_models <- list()

for (state in specific_states) {
    state_data <- subset(pdata, State == state)
    state_models[[state]] <- plm(lnDOD ~ lnSAF + lnMAF + lnUE + PCI + lnHP + lnPOP,
                                 data = state_data, model = "within")
}



# Use stargazer to create a single HTML file with all models
stargazer(state_models, type = "html", out = "state_specific_models_summary.html",
          title = "State Specific Panel Data Regression Models",
          model.names = TRUE,
          column.labels = c("Arizona", "Louisiana", "New Hampshire", "Ohio", "Tennessee"),
          covariate.labels = c("lnSAF", "lnMAF", "lnUE", "PCI", "lnHP"),
          omit.stat = c("LL", "ser", "f"), align = TRUE)

```
